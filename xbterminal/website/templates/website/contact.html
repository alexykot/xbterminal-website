{% extends "website/base.html" %}

{% block content %}
{% load bootstrap %}
<div id="wrap">
  {% include "website/common/header.html" %}
  <div class="container">
  <div class="row">&nbsp;</div>
  <div class="row">
    <div class="col-md-6">
      {% load staticfiles %}
      <img src="{% static 'landing/img/terminal.png' %}" alt=""/>
    </div>
    <div class="col-md-6" id="contact_view">
      <h3>Contact form:</h3>
      <form role="form" action="{% url 'website:contact' %}" method="post" id="contact_form">
        {% csrf_token %}
        {{form | bootstrap}}
        <button type="button" id="contact_send" class="btn btn-default pull-right">Send</button>
      </form>
    </div>
  </div>
  <div class="row">&nbsp;</div>
</div>
</div>

{% include "website/common/footer.html" %}
{% endblock %}

{% block js %}
<script src="{% static 'website/js/handlebars-v1.1.2.js' %}" type="text/javascript"></script>
{% verbatim %}
<script id="entry-template" type="text/x-handlebars-template">
<div class="alert alert-danger alert-dismissable">
  <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
  <strong>Warning!</strong>
  <ul>
  {{#each hb_message}}
  <li>{{this}}</li>
  {{/each}}
</ul>
</div>
</script>
{% endverbatim %}
{% endblock %}

{% block ready %}
$(".alert").alert();
$(document).on("click","#contact_send",function(){
  console.log("fire!");
  $.ajax({
    type: 'POST',
    url: {% url 'website:contact' %},
    data: $('#contact_form').serialize(),
    success: function(data) {
      if(data.msg == 'ok') {
        $('#contact_view').empty();
        $('#contact_view').html("<h3>Thanks!</h3><p class='lead'>We will contact you as soon as possible</p>");
      }
      else {
        err_msg = [];
        for(var x in Object.keys(data)) {
          var field = Object.keys(data)[x];
          if(field != "msg") {
            err_msg.push(field.replace('_',' ') + " - " + data[field].join(","));
          }
        };
        var source   = $("#entry-template").html();
        var template = Handlebars.compile(source);
        var context = {"hb_message": err_msg}
        var html    = template(context);
        $('#contact_view').html(html + $('#contact_view').html());
      }
    }
  })
});
{% endblock %}
